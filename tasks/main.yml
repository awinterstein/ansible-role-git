---
- include_tasks: lfs-repo.yml
- name: Install Git
  apt: name={{item}} state=present update_cache=yes
  with_items:
    - git
    - git-lfs
  become: true
- name: Install Git GUI
  apt: name={{item}} state=present
  with_items:
    - git-gui
    - gitk
  become: true
  when: git_install_gui
- name: Install Git Cola
  apt: name={{item}} state=present
  with_items:
    - git-cola
  become: true
  when: git_install_git_cola
- name: Set name for Git
  ini_file:
    path: "{{homedir}}/.gitconfig"
    section: user
    option: name
    value: "{{username}}"
  when: username is defined
- name: Set mail for Git
  ini_file:
    path: "{{homedir}}/.gitconfig"
    section: user
    option: email
    value: "{{usermail}}"
  when: usermail is defined
- name: Set push to simple for Git
  ini_file:
    path: "{{homedir}}/.gitconfig"
    section: push
    option: default
    value: simple
- name: Set askpass if it was defined
  ini_file:
    path: "{{homedir}}/.gitconfig"
    section: core
    option: askpass
    value: "{{askpass}}"
  when: askpass is defined
- name: Set colorful prompt showing the git status
  lineinfile:
    path: "{{homedir}}/.bashrc"
    regexp: 'PS1=.*\\033'
    line: "PS1='`if [ $? = 0 ]; then echo \"\\[\\e[32m\\] ✔ \"; else echo \"\\[\\e[31m\\] ✘ \"; fi`\\[\\033[01;32m\\]\\u@\\h\\[\\033[00m\\]:\\[\\e[01;34m\\]\\w\\[\\e[00;34m\\] `(( $(git status --porcelain 2>/dev/null | wc -l) == 0 )) && echo \"\\[\\e[01;32m\\]\" || ( (( $(git status --porcelain --untracked-files=no 2>/dev/null | wc -l) > 0 )) && echo \"\\[\\e[01;31m\\]\" ) || echo \"\\[\\e[01;33m\\]\"`$(__git_ps1 \"(%s)\")`echo \"\\[\\e[00m\\]\"`\\$ '"

- include_tasks: config-kde.yml
  when: desktop_environment is defined and desktop_environment == "KDE"
